var mysql=require("mysql");var express=require("express");var app=express();var morgan=require("morgan");var bodyParser=require("body-parser");var methodOverride=require("method-override");var Config=require("config-js");var config=new Config("config/configuracija.js");var dbcon=mysql.createPool({connectionLimit:config.get("sequel.conlimt"),host:config.get("sequel.link"),user:config.get("sequel.juzer"),password:config.get("sequel.lozinka"),database:config.get("sequel.baza"),port:config.get("sequel.prt")});var ver=config.get("ver.dev");console.log("*********************************************\nserver version "+ver+"\n*********************************************\n*********************************************\ninitial components loaded\n*********************************************\n");app.use("/scripts",express["static"]("./node_modules/"));app.use("/angular",express["static"]("./angular/"));app.use("/images",express["static"]("./views/images/"));app.use("/views",express["static"]("./views/"));app.use(bodyParser.json());app.use(bodyParser.urlencoded({extended:true}));app.get("/",function(b,a){console.log("This is req.url: ",b.url);a.sendFile(__dirname+"/views/index.html")});testDataBaseConnection(function(a){if(a){console.log("SERVER: Connection to the database established... ")}else{console.log("ERROR")}});app.listen(80,function(){console.log(ver," Initialization sequence complete. ");console.log(new Date(),"Started listening on port:80")});function testDataBaseConnection(a){dbcon.getConnection(function(c,b){dbcon.query("SELECT 1+0 AS selection",function(d,e){if(d){if(d.fatal){console.log("Processor: ",new Date(),"Doslo je do prekida komunikacije sa bazom podataka");throw d}console.error("Processor: ",new Date(),"Could not connect to the db. Check if the DB is running?",d.code,d.fatal);a(false)}else{console.log("Processor: ",new Date(),"Connection successful",e[0].selection);console.log("Processor: Database is set.");a(true)}});b.release()})};
"use strict";var mysql=require("mysql");var Config=require("config-js");var config=new Config("./config/configuracija.js");var dbcon=mysql.createPool({connectionLimit:config.get("sequel.conlimt"),host:config.get("sequel.link"),user:config.get("sequel.juzer"),password:config.get("sequel.lozinka"),database:config.get("sequel.baza"),port:config.get("sequel.prt")});exports.testDataBaseConnection=function(a){dbcon.getConnection(function(c,b){dbcon.query("SELECT 1+0 AS selection",function(d,e){if(d){if(d.fatal){console.log("Processor: ",new Date(),"Doslo je do prekida komunikacije sa bazom podataka");throw d}console.error("Processor: ",new Date(),"Could not connect to the db. Check if the DB is running?",d.code,d.fatal);a(false)}else{console.log("Processor: ",new Date(),"Connection successful",e[0].selection);console.log("Processor: Database is set.");a(true)}});b.release()})};exports.createNewVehicle=function(b,c){var a=[];console.log("POST: createNewVehicle: Incoming from client: ",b);dbcon.getConnection(function(e,d){console.log(b.vehicle);d.query(config.get("vhl.ins"),[b.vehicle.vin,b.vehicle.licensePlate,b.vehicle.make,b.vehicle.model,b.vehicle.year],function(g,h){if(g){if(g.fatal){throw g}console.error("Processor: createNewVehicle: Insert new vehicle",new Date(),config.get("poruke.konNaBazu"),g.code,g.fatal)}a=h;console.log("createNewVehicle -> results: ",a);var f=JSON.stringify(a);c(f)});d.release()})};exports.updateVehicle=function(b,c){var a=[];console.log("PUT: updateVehicle (upd1: Incoming from client: ",b);dbcon.getConnection(function(e,d){console.log(b.vehicle);d.query(config.get("vhl.upd1"),[b.vehicle.vin,b.vehicle.licensePlate,b.vehicle.make,b.vehicle.model,b.vehicle.color,b.vehicle.year,b.vehicle.vin],function(g,h){if(g){if(g.fatal){throw g}console.error("Processor: updateVehicle1: Update vehicle information",new Date(),config.get("poruke.konNaBazu"),g.code,g.fatal)}a=h;var f=JSON.stringify(a);c(f)});d.release()})};exports.getAllVehicles=function(b){var a=[];dbcon.getConnection(function(d,c){c.query(config.get("vhl.slt"),function(f,g){if(f){if(f.fatal){throw f}console.error("Processor: getAllVehicles: List of vehicles",new Date(),config.get("poruke.konNaBazu"),f.code,f.fatal)}a=g;var e=JSON.stringify(a);b(e)});c.release()})};exports.getAllUsers=function(b){var a=[];dbcon.getConnection(function(d,c){c.query(config.get("usr.slt"),function(f,g){if(f){if(f.fatal){throw f}console.error("Processor: getAllUsers: List of users",new Date(),config.get("poruke.konNaBazu"),f.code,f.fatal)}a=g;var e=JSON.stringify(a);b(e)});c.release()})};exports.createNewUser=function(b,c){var a=[];console.log("POST: createNewUser: Incoming from client: ",b);dbcon.getConnection(function(e,d){console.log(b.user);d.query(config.get("usr.ins"),[b.user],function(g,h){if(g){if(g.fatal){throw g}console.error("Processor: createNewUser: Insert new user",new Date(),config.get("poruke.konNaBazu"),g.code,g.fatal)}a=h;console.log("createNewUser -> results: ",a);var f=JSON.stringify(a);c(f)});d.release()})};